# Build-Measure-Learn Cycle 001: Infrastructure Assessment
# Focus: Avoid vanity metrics, validate core needs before engineering
# Risk Mitigation: Document actual state vs. assumptions

cycle_id: "BML-001"
phase: "MEASURE"
started_at: "2025-11-17T18:50:00Z"
owner: "assessor_circle"

# =============================================================================
# WHAT WE'RE MEASURING (Avoid Hallucination)
# =============================================================================
measurement_goals:
  - goal: "Inventory existing agentic scripts and their actual usage"
    why: "Prevent duplication before building new tools"
    blocker_if_skipped: "Resource waste, technical debt"
    
  - goal: "Validate OpenStack/StarlingX/HostBill integration status"
    why: "Confirm 'prior affiliate system efforts' are documented"
    blocker_if_skipped: "Lost context, rework"
    
  - goal: "Test doc_query.py performance baseline"
    why: "Establish <1s search target is achievable"
    blocker_if_skipped: "Unrealistic targets, scope creep"
    
  - goal: "Count active vs. zombie solutions in retiring/"
    why: "Horizon 0 neglect creates maintenance burden"
    blocker_if_skipped: "Continued OpEx on dead projects"

# =============================================================================
# CURRENT STATE INVENTORY (Evidence-Based)
# =============================================================================
existing_scripts:
  discord_integration:
    path: "scripts/discord_wsjf_bot.py"
    lines: 200
    status: "ACTIVE"
    functionality: "WSJF status, blockers, approval notifications"
    dependencies: ["discord.py", ".goalie/CONSOLIDATED_ACTIONS.yaml"]
    last_used: "Unknown - needs log analysis"
    gaps: ["No Discord token set in env", "Approval log integration incomplete"]
    
  learning_infrastructure:
    path: "scripts/agentic/learning_hooks_system.py"
    lines: 178
    status: "ACTIVE"
    functionality: "BEAM tracking, verdict classification, confidence intervals"
    dependencies: [".agentdb/agentdb.sqlite", "logs/learning/events.jsonl"]
    last_used: "Unknown"
    gaps: ["AgentDB schema validation needed", "BEAM taxonomy incomplete"]
    
  kanban_sync:
    path: "scripts/agentic/kanban_sync.py"
    lines: 200
    status: "ACTIVE"
    functionality: "YAML â†” VSCode sync, WIP tracking"
    dependencies: [".goalie/KANBAN_BOARD.yaml", ".vscode/kanban.json"]
    last_used: "Unknown"
    gaps: ["VSCode extension not published", "Cursor/Windsurf/Zed integration missing"]
    
  doc_query:
    path: "scripts/doc_query.py"
    lines: 199
    status: "ACTIVE"
    functionality: "Regex search, action item extraction, WSJF linking"
    dependencies: [".goalie/insights_log.jsonl"]
    last_used: "Unknown"
    gaps: ["No performance tests", "No DoR/DoD", "No retrospective integration"]

existing_platforms:
  openstack:
    path: "investing/platform-infrastructure/openstack/"
    scripts: ["discover_openstack_services.sh", "openstack_caracal_install.sh"]
    status: "INVESTING"
    documentation: "docs/starlingx_integration.md"
    circle: "orchestrator"
    gaps: ["IPMI connectivity untested", "Upstream sync not configured"]
    
  starlingx:
    path: "investing/platform-infrastructure/starlingx/"
    scripts: ["harden-starlingx.sh", "refine-starlingx-security-fixed.sh"]
    status: "INVESTING"
    circle: "assessor"
    gaps: ["Security hardening validation incomplete"]
    
  affiliate_system:
    path: "emerging/affiliate-platform/"
    scripts: ["src/validate_affiliate_attribution.sh"]
    status: "EMERGING"
    circle: "innovator"
    gaps: ["Attribution validation incomplete", "CapEx tracking needs baseline"]
    
  hostbill:
    path: "investing/hostbill-integration/"
    scripts: ["src/hostbill_openstack_test.py"]
    status: "INVESTING"
    circle: "orchestrator"
    gaps: ["OpenStack billing integration test results missing"]

# =============================================================================
# GAPS IDENTIFIED (Honest Assessment)
# =============================================================================
critical_gaps:
  missing_platforms:
    - name: "WordPress ecosystem"
      evidence: "No wp-config.php found in code/"
      impact: "HIGH - user mentioned explicitly"
      hypothesis: "May be deployed on servers, not local"
      validation_needed: true
      
    - name: "Flarum forum"
      evidence: "No flarum directory found"
      impact: "HIGH - user mentioned explicitly"
      hypothesis: "May be deployed remotely"
      validation_needed: true
      
    - name: "Trading platforms (TradingView, Finviz, IB)"
      evidence: "No trading platform integrations found"
      impact: "HIGH - user mentioned explicitly"
      hypothesis: "APIs or browser extensions, not local code"
      validation_needed: true
      
    - name: "Temporal workflows"
      evidence: "No temporal/ directory found"
      impact: "MEDIUM - mentioned for DecisionCall.com automation"
      hypothesis: "Not yet implemented"
      validation_needed: true
      
    - name: "Donor advised funding"
      evidence: "No donor funding code found"
      impact: "MEDIUM"
      hypothesis: "Financial planning context, may not need code"
      validation_needed: true
  
  missing_ipmi:
    evidence: "User mentioned 'IPMI connectivity' but no IPMI scripts found"
    impact: "BLOCKER for StarlingX deployment"
    hypothesis: "IPMI configuration needs separate discovery"
    validation_needed: true
  
  missing_dreamlab:
    evidence: "User mentioned 'DreamLab Metaverse Ontology' but no references found"
    impact: "LOW - ontology framework, not code"
    hypothesis: "Academic/research reference for AI grounding"
    validation_needed: false
  
  retiring_horizon:
    current_status: "0% budget allocation"
    zombie_solutions: []  # To be discovered
    validation_needed: true

# =============================================================================
# MEASUREMENTS TO TAKE (Next 30 min)
# =============================================================================
measurement_tasks:
  - id: "MEASURE-001"
    task: "Run doc_query.py performance test"
    command: |
      cd /Users/shahroozbhopti/Documents/code/investing/agentic-flow
      time python3 scripts/doc_query.py "WSJF" --json > /tmp/doc_query_test.json
      wc -l /tmp/doc_query_test.json
    target: "< 1 second execution"
    success_criteria: "Exit code 0, results returned"
    
  - id: "MEASURE-002"
    task: "Count .goalie YAML configs and check for staleness"
    command: |
      ls -la .goalie/*.yaml
      for f in .goalie/*.yaml; do echo "=== $f ==="; head -20 "$f"; done
    target: "Identify which configs are actively used"
    success_criteria: "List all YAMLs with metadata"
    
  - id: "MEASURE-003"
    task: "GitHub repos inventory with gh CLI"
    command: |
      gh repo list --json name,description,isArchived,updatedAt,visibility --limit 100 > /tmp/github_repos.json
      jq -r '.[] | select(.isArchived == false) | "\(.name) - \(.updatedAt)"' /tmp/github_repos.json
    target: "Catalog all active repos"
    success_criteria: "JSON file with repo metadata"
    
  - id: "MEASURE-004"
    task: "Search for zombie solutions (no commits in 90 days)"
    command: |
      find /Users/shahroozbhopti/Documents/code/{evaluating,emerging,investing} -type d -name ".git" -maxdepth 3 | while read repo; do
        cd "$(dirname "$repo")"
        last_commit=$(git log -1 --format=%ct 2>/dev/null || echo 0)
        now=$(date +%s)
        age_days=$(( (now - last_commit) / 86400 ))
        if [ $age_days -gt 90 ]; then
          echo "ZOMBIE: $(pwd) - $age_days days since last commit"
        fi
      done
    target: "Identify candidates for retiring/"
    success_criteria: "List of stale projects"
    
  - id: "MEASURE-005"
    task: "Check Discord bot environment"
    command: |
      env | grep -i discord || echo "DISCORD_* not set"
      python3 -c "import discord; print(f'discord.py version: {discord.__version__}')" 2>&1
    target: "Validate Discord integration readiness"
    success_criteria: "Know if discord.py installed and token available"
    
  - id: "MEASURE-006"
    task: "Validate AgentDB schema for learning hooks"
    command: |
      sqlite3 .agentdb/agentdb.sqlite ".schema learning_events" 2>&1 || echo "learning_events table missing"
    target: "Confirm learning_hooks_system.py can write to DB"
    success_criteria: "Table exists or clear error message"
    
  - id: "MEASURE-007"
    task: "Test agentic-jujutsu installation"
    command: |
      npx agentic-jujutsu --version 2>&1
      npx agentic-jujutsu status 2>&1 | head -20
    target: "Verify agentic tooling works"
    success_criteria: "Command runs without errors"

# =============================================================================
# RISK MITIGATION (Anti-Hallucination Protocol)
# =============================================================================
hallucination_risks:
  - risk: "Assuming WordPress/Flarum exist locally when they may be remote"
    mitigation: "Ask user for deployment locations before creating structures"
    
  - risk: "Assuming trading platforms need code integration vs. API keys"
    mitigation: "Validate use case: automated trading vs. manual research"
    
  - risk: "Creating comprehensive solutions before validating core needs"
    mitigation: "This MEASURE phase - gather evidence first"
    
  - risk: "Ignoring existing scripts and recreating functionality"
    mitigation: "Inventory complete before any BUILD phase"
    
  - risk: "Misinterpreting academic references (DreamLab, Cell papers) as implementation requirements"
    mitigation: "Clarify if these are inspiration vs. direct dependencies"

# =============================================================================
# BLOCKERS TO SURFACE
# =============================================================================
blockers_to_validate:
  - blocker: "IPMI connectivity for StarlingX"
    current_state: "Unknown - no IPMI scripts found"
    validation: "Check if IPMI is StarlingX prerequisite or optional"
    escalation: "seeker_circle for research"
    
  - blocker: "Discord bot credentials"
    current_state: "DISCORD_BOT_TOKEN not in environment"
    validation: "Is Discord integration actually used or aspirational?"
    escalation: "orchestrator_circle for ops decision"
    
  - blocker: "AgentDB schema mismatch"
    current_state: "learning_hooks_system.py writes to learning_events table"
    validation: "Does table exist? Schema match?"
    escalation: "assessor_circle for data integrity"

# =============================================================================
# NEXT PHASE: LEARN
# =============================================================================
learn_phase_questions:
  - "Which scripts are actually used vs. which are aspirational?"
  - "Where are WordPress/Flarum/trading platforms deployed?"
  - "Is IPMI a hard blocker or can we proceed without it?"
  - "What's the priority: build new tools or optimize existing ones?"
  - "Should we focus on agentic tribe coordination or platform integration first?"

next_cycle: "BML-002-LEARN"
scheduled_at: "2025-11-17T19:30:00Z"
