# Pattern metrics logging helper
log_pattern_event() {
    local pattern="$1"
    local mode="$2"
    local gate="$3"
    local reason="$4"
    local action="$5"

    local ts
    ts="$(date -u +"%Y-%m-%dT%H:%M:%SZ")"

    local run_kind="${AF_RUN_KIND:-unknown}"
    local iteration="${AF_RUN_ITERATION:-0}"
    local circle="${AF_CIRCLE:-unknown}"
    local depth="${AF_DEPTH_LEVEL:-0}"
    local framework="${AF_FRAMEWORK:-}"
    local scheduler="${AF_SCHEDULER:-}"
    local mutation="false"
    if [[ "$mode" == *"mutate"* ]] || [[ "$mode" == *"enforce"* ]] || [[ "$mode" == *"blocking"* ]]; then
        mutation="true"
    fi

    # Ensure .goalie directory exists
    mkdir -p "$PROJECT_ROOT/.goalie"

    printf "{\"ts\":\"%s\",\"run\":\"%s\",\"iteration\":%s," \
        "$ts" "$run_kind" "$iteration" >> "$PROJECT_ROOT/.goalie/pattern_metrics.jsonl"
    printf "\"circle\":\"%s\",\"depth\":%s," \
        "$circle" "$depth" >> "$PROJECT_ROOT/.goalie/pattern_metrics.jsonl"
    printf "\"pattern\":\"%s\",\"mode\":\"%s\",\"mutation\":%s,\"gate\":\"%s\"," \
        "$pattern" "$mode" "$mutation" "$gate" >> "$PROJECT_ROOT/.goalie/pattern_metrics.jsonl"
    printf "\"framework\":\"%s\",\"scheduler\":\"%s\",\"reason\":\"%s\",\"action\":\"%s\"}\n" \
        "$framework" "$scheduler" "$reason" "$action" >> "$PROJECT_ROOT/.goalie/pattern_metrics.jsonl"
}

show_help() {
